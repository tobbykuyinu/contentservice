language: node_js
node_js: "4.3"

on:
   tags: true

sudo: true

install:
  - npm install

env:
  global:
    - CONTENTFUL_CONTENT_DELIVERY_API_KEY=0abcd
    - CONTENTFUL_CONTENT_PREVIEW_API_KEY=0abcd
    - CONTENTFUL_SPACE_ID=0abcd
    - API_SEARCH_URL_TIER_1=http://localhost:8000/1
    - API_SEARCH_URL_TIER_2=http://localhost:8000/1
    - GOOGLE_API_CLIENT_EMAIL=client-email-goes-in-here
    - GOOGLE_API_PRIVATE_KEY='-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQC0AuXQgn3IkhcK\ns0eC0Z3qSwhI+OBk5O0lQK/WQCzX2ccIszDekBmlV+pxyZwmGBAErNOOajCEmVf7\n1wOEjAPBlA0t5EuNUDc/uPBADTCGS9OvZJ+ejanwW57+SExlaHHevV24a9dqmqof\nmXAJg25bFKHIQa5TQPQY6Qu1MRSnUw84Z+q0iiwbbznxmAyXpeFCC4vEUaY0ZXh3\nsqbhB303wRV8NcPuIDgOHWroYsjpM4nzzk96A04OcwlsLedsze0ZZO9H6J2VDysM\n9roM7D8CUKuuzsEnoBbNEYMJ7H6ifkHPMCWJr/lJ7zLftzjaVki5yvIBfhNgeY5l\nR1PLb3U1AgMBAAECggEAdWqedM9pNHb2SKiAMLiCBN1EXjTYSXd5qB71kw7xMSqA\nRRB9A++CivM5nVcgX0i6yhHhPLfPRe6wETlCtiaOHKpxnkmXbmmwYARF0cHIsRCs\n128PHuDQxFM+9iY6jrr964ghpbXSIVsZNNtk1Q/B3+8pR/JvvyZTEhyQ4nNNQYY4\nA01F3bcQvBh398VL8Msk4DR0TlDIrFWZGdKfqjxWDFkXXKvHDNPUcKLxO9TojGRa\nvayzUkQYqKGAoJDWETO2BcO5vwe00zJNCM34sjwWWdzhkZKvLZDiG1gmr9uswfhx\n5/zICRe5N5uvuoNUTeApvOMwnySPkMPhOdAQIklE0QKBgQDaf7W13IyhQSfPKfBA\nm7CJoLDcVn1NvCb3jks+hNnfFeqUVHq4Y66Qkbxscq5n9/Yj5VO0pcmPTRU9Ryuy\nfpyuc+R0Ce2UJBFv2plfEPYLMpcUHZ+JloLJSb3/CoKwIj3hYQWB148jHsFPHfjh\nUyVK4O8T49VFIno3NMxAqzAHJwKBgQDS6CRXgv6tcp8QzlTF1uHt5lWzIBdT9afM\nWO/d2de3O3NDcDKaVDfSJU7+OkLVNXr3bFv8Naa+amYyqCA6z52wzdScqnYLE6uX\nJpvqRyAw2nYLUuCws9LtMPUr2H9QXx2MPX/MBhDSPoFHWISME6ICrfmcIbNacGBw\nhd7I8wN6QwKBgGJJ+srRaK2NasQFQJ8/qf1vPMARZBKY5gqMhwqbpop1CG4rRn01\n0iwUcudx+0SnxaDGI45q2a3N5hUHs/96dy7+0TDl2mq+gt2HP2EFdzj4S//vh3nU\nLAcyVfapmrpy3NVK2Lhc6HXK+viFKhTqWydA4itXXPPZm5LD/HHG0DcXAoGANYOr\nvPzDDFWaINSJ1A07FHcuZZ4N7ULWydYDPwKIZrjR/VmZrWkTJOJMkdtMm/bO9brr\n+CnQ3l33AoGAdAu8EmGXwgzKmPLrxhWI2EAl3d+AtkzYMF3gdkjG3NI5M7Z+s9fi\n9mzPldlASk8eisBsikuEm2Y9sQP0pHiDV++5gSsCgYAcPHTcVdR1Y9NKTaPD5S89\nal7xsu8koS1M7g2RtUgWwYiEStkUBvSi1KyfQMUVljt5BTKomMRNfH2lCU4yyrsI\nse/MLLeREYImB9XWIzcg9UXvyc3LfF8oNfjf6ohOGBoUyV5RBJjooyGs6zEDZGj2\nKi86quCc5b6AHiNSKsZrHg==\n-----END PRIVATE KEY-----\n'
    - VN_ANALYTICS_ID=ga:1234
    - PH_ANALYTICS_ID=ga:1234
    - ID_ANALYTICS_ID=ga:1234
    - MM_ANALYTICS_ID=ga:1234
    - MX_ANALYTICS_ID=ga:1234
    - BD_ANALYTICS_ID=ga:1234
    - PK_ANALYTICS_ID=ga:1234
    - LK_ANALYTICS_ID=ga:1234
    - SA_ANALYTICS_ID=ga:1234
    - QA_ANALYTICS_ID=ga:1234

script:
  - npm run lint
  - npm run regression

after_success:
  - sudo pip install --upgrade pip
  - sudo pip install awscli
  - aws configure set AWS_ACCESS_KEY_ID $AWS_ACCESS_KEY_ID
  - aws configure set AWS_SECRET_ACCESS_KEY $AWS_SECRET_ACCESS_KEY
  - chmod +x ./deploy/deploy.sh
  - ./deploy/deploy.sh
